<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ÏûêÏú† Í≤åÏãúÌåê</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<nav th:replace="~{components/nav :: nav(${admin.adminName})}"></nav>
<div class="container mt-3">
    <h1 class="mt-3 mb-3">ÏûêÏú† Í≤åÏãúÌåê Í¥ÄÎ¶¨</h1>
    <h3 th:if="${errorMessage}" th:text="${errorMessage}"></h3>
    <form action="/board/free" method="get">
        <div class="d-flex align-items-center">
            <div class="me-2">
                <label for="startDate" class="form-label">Îì±Î°ùÏùºÏãú</label>
            </div>
            <div class="me-2">
                <input class="form-control" type="date" name="startDate" id="startDate"
                       th:value="${searchCondition.startDate}">
            </div>
            <div class="me-2">
                <label for="startDate" class="form-label">~</label>
            </div>
            <div class="me-2">
                <input class="form-control" type="date" name="endDate" id="endDate"
                       th:value="${searchCondition.endDate}">
            </div>
            <div class="me-2">
                <select class="form-select" name="categoryId" id="categoryId">
                    <option value="-1" th:selected="${searchCondition.category == -1}">Ï†ÑÏ≤¥ Î∂ÑÎ•ò</option>
                    <option th:each="category : ${categoryList}"
                            th:value="${category.categoryId}"
                            th:text="${category.categoryName}"
                            th:selected="${searchCondition.category == category.categoryId}">
                    </option>
                </select>
            </div>
            <div class="me-2 flex-grow-1">
                <input class="form-control" type="text" name="searchText" id="searchText" placeholder="Ï†úÎ™© or ÎÇ¥Ïö©"
                       th:value="${searchCondition.searchText}">
            </div>
            <div>
                <input class="btn btn-primary" style="width: 100px" type="submit" value="Í≤ÄÏÉâ">
            </div>
        </div>
        <div class="d-flex align-items-center justify-content-between" style="margin-top: 3px">
            <div class="me-2 d-flex align-items-center">
                <select name="pageSize" id="pageSize" class="form-select">
                    <option value="10" th:selected="${searchCondition.pageSize == 10}">10</option>
                    <option value="20" th:selected="${searchCondition.pageSize == 20}">20</option>
                    <option value="30" th:selected="${searchCondition.pageSize == 30}">30</option>
                    <option value="40" th:selected="${searchCondition.pageSize == 40}">40</option>
                    <option value="50" th:selected="${searchCondition.pageSize == 50}">50</option>
                </select>
                <span class="ms-2 form-text">Í∞úÏî© Î≥¥Í∏∞</span>
            </div>

            <div class="d-flex align-items-center">
                <div class="me-2">
                    <span class="form-text">Ï†ïÎ†¨</span>
                </div>
                <div class="me-2">
                    <select name="orderValue" id="orderValue" class="form-select">
                        <option value="createdAt" th:selected="${searchCondition.orderValue == 'createdAt'}">Îì±Î°ù ÏùºÏãú
                        </option>
                        <option value="category" th:selected="${searchCondition.orderValue == 'category'}">Î∂ÑÎ•ò</option>
                        <option value="title" th:selected="${searchCondition.orderValue == 'title'}">Ï†úÎ™©</option>
                        <option value="views" th:selected="${searchCondition.orderValue == 'views'}">Ï°∞ÌöåÏàò</option>
                    </select>
                </div>
                <div class="me-2">
                    <select name="orderDirection" id="orderDirection" class="form-select">
                        <option value="desc" th:selected="${searchCondition.orderDirection == 'desc'}">ÎÇ¥Î¶ºÏ∞®Ïàú</option>
                        <option value="asc" th:selected="${searchCondition.orderDirection == 'asc'}">Ïò§Î¶ÑÏ∞®Ïàú</option>
                    </select>
                </div>
            </div>
        </div>
    </form>
    <hr/>
    <button class="btn btn-primary" th:onclick="goToWrite([[${searchCondition}]])">Í∏Ä Îì±Î°ù</button>

    <table class="table table-hover">
        <thead>
        <tr>
            <th scope="col" class="text-center col-1">Î≤àÌò∏</th>
            <th scope="col" class="text-center col-1">Î∂ÑÎ•ò</th>
            <th scope="col" class="text-start col-6">Ï†úÎ™©</th>
            <th scope="col" class="text-center col-1">Ï°∞Ìöå</th>
            <th scope="col" class="text-center col-2">Îì±Î°ùÏùºÏãú</th>
            <th scope="col" class="text-center col-1">Îì±Î°ùÏûê</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="board : ${boardList}">
            <td class="text-center">
                <span class="link" th:text="${board.boardId}"
                      th:onclick="goToBoard([[${board.boardId}]],[[${searchCondition}]])"></span>
            </td>
            <td class="text-center" th:text="${board.categoryName}"></td>
            <td class="text-start">
                <span class="link" th:if="${#strings.length(board.title) > 48}"
                      th:text="${board.title.substring(0, 48) + '...'}"
                      th:onclick="goToBoard([[${board.boardId}]],[[${searchCondition}]])"></span>

                <span class="link" th:if="${#strings.length(board.title) <= 48}"
                      th:text="${board.title}"
                      th:onclick="goToBoard([[${board.boardId}]],[[${searchCondition}]])"></span>
                <span th:if="${board.fileId != null}">üìÅ</span>
                <span th:if="${board.commentCount > 1}" th:text="'('+${board.commentCount}+')'"></span>
            </td>
            <td class="text-center" th:text="${board.views}"></td>
            <td class="text-center" th:text="${#dates.format(board.createdAt,'yyyy.MM.dd hh:mm')}"></td>
            <td class="text-center" th:if="${board.adminName != null}" th:text="${board.adminName}"></td>
            <td class="text-center" th:unless="${board.adminName != null}" th:text="${board.memberName}"></td>
        </tr>
        </tbody>
    </table>

    <nav th:if="${totalPageNum > 1}" aria-label="Page navigation" class="d-flex justify-content-center">
        <ul class="pagination">
            <li th:each="pageNum : ${#numbers.sequence(1,totalPageNum)}" class="page-item"
                th:classappend="${pageNum} == ${searchCondition.pageNum} ? 'active' : ''">
                <a class="page-link" href="#" th:text="${pageNum}"
                   th:onclick="goToPageNum([[${pageNum}]],[[${searchCondition}]])"></a>
            </li>
        </ul>
    </nav>
</div>
</body>
<script th:inline="javascript">
    const writeSuccess = [[${write}]];
    const deleteSuccess = [[${delete}]];

    if (writeSuccess === 1) {
        alert("Îì±Î°ù ÎêòÏóàÏäµÎãàÎã§.");
    }

    if (deleteSuccess === 1) {
        alert("ÏÇ≠Ï†ú ÎêòÏóàÏäµÎãàÎã§.");
    }

    const getNewBoardList = () => {
        const startDate = $("#startDate").val();
        const endDate = $("#endDate").val();
        const categoryId = $("#categoryId").val();
        const searchText = $("#searchText").val();
        const pageSize = $("#pageSize").val();
        const orderValue = $("#orderValue").val();
        const orderDirection = $("#orderDirection").val();
        const url = `/board/free?startDate=${startDate}&endDate=${endDate}&category=${categoryId}`
            + `&searchText=${searchText}&pageSize=${pageSize}&orderValue=${orderValue}&orderDirection=${orderDirection}`;
        window.location.href = url;
    }

    $("#pageSize, #orderValue, #orderDirection").change(getNewBoardList);

    const parseObjectToParam = (searchCondition) => {
        return `?startDate=${searchCondition.startDate}&endDate=${searchCondition.endDate}&category=${searchCondition.category}` +
            `&searchText=${searchCondition.searchText}&pageSize=${searchCondition.pageSize}&orderValue=${searchCondition.orderValue}` +
            `&orderDirection=${searchCondition.orderDirection}&pageNum=${searchCondition.pageNum}`;
    }

    const goToPageNum = (pageNum, searchCondition) => {
        searchCondition.pageNum = pageNum;
        location.href = `/board/free` + parseObjectToParam(searchCondition);
    }

    const goToWrite = (searchCondition) => {
        location.href = `/board/free/write` + parseObjectToParam(searchCondition);
    }

    const goToBoard = (boardId, searchCondition) => {
        location.href = `/board/free/${boardId}` + parseObjectToParam(searchCondition);
    }
</script>
<style>
    .link {
        cursor: pointer;
        text-decoration: none;
    }

    .link:hover {
        text-decoration: underline;
    }
</style>
</html>